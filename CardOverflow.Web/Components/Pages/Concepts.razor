@page "/Concepts"
@using CardOverflow.Api
@using CardOverflow.Entity
@using CardOverflow.Web.Helpers
@inject IJSRuntime JsRuntime
@inject CardRepository CardRepository
@inject ConceptRepository ConceptRepository

<input type="text" bind-value-oninput="@Question" placeholder="Question" />
<input type="text" bind-value-oninput="@Answer" placeholder="Answer" />
<button class="btn btn-primary" onclick="@Save">Save</button>

<table class='table'>
  <thead>
    <tr>
      <th>Title</th>
      <th>Description</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    @foreach (var concept in ConceptList) {
      <ConceptView Concept="@concept" Delete="@(() => Delete(concept))" />
    }
  </tbody>
</table>

<button onclick="@AddConcept">Add Concept</button>
<button onclick="@Save">Save</button>

@functions {
  string Question = "";
  string Answer = "";
  List<Concept> ConceptList;

  protected override async Task OnInitAsync() {
    ConceptList = ConceptRepository.GetConcepts();
  }

  void Delete(Concept concept) {
    ConceptList.Remove(concept);
    StateHasChanged();
  }

  void AddConcept() =>
    new Concept { Title = "Title", Description = "Description" }
    .Do(ConceptList.Add);

  void Save() {
    ConceptRepository.SaveConcepts(ConceptList);
    // TODO: Set focus back on Question https://devblogs.microsoft.com/aspnet/blazor-0-3-0-experimental-release-now-available/
  }

}
