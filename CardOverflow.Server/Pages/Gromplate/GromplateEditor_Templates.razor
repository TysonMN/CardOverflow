@using Microsoft.AspNetCore.Mvc
@using Microsoft.FSharp.Collections
@using Microsoft.FSharp.Core
@using CardOverflow.Entity
@using CardOverflow.Debug
@using CardOverflow.Pure
@using CardOverflow.Api
@using Microsoft.AspNetCore.Components
@using Microsoft.AspNetCore.Identity
@using CardOverflow.Sanitation
@using CardOverflow.Server.Data
@using Microsoft.AspNetCore.WebUtilities
@using ThoughtDesign.WebLibrary
@inject NavigationManager NavigationManager
@inject IToastService ToastService
@inject DbExecutor DbExecutor

<div class="d-flex justify-content-between mt-3">
  <div></div>
  <h3>Templates</h3>
  <div>
    @if (Instance.Templates.IsStandard) {
      <button type="button" class="btn btn-success" @onclick=AddTemplate disabled=@IsDisabled>
        <span class="oi oi-plus"></span>
      </button>
    }
  </div>
</div>
<div class="">
  @foreach (var template in Instance.JustTemplates) {
    <GromplateEditor_Template
                            Template=@template
                            Css=@Instance.Css
                            DisplayDelete=@(Instance.JustTemplates.Count() >= 2)
                            Delete=@(() => DeleteTemplate(template))
                            IsDisabled=@IsDisabled />
  }
</div>

@code {
  [Parameter] public ViewGromplateInstance Instance { get; set; }
  [Parameter] public EventCallback<GromplateType> UpdateGromplateType { get; set; }
  [Parameter] public bool IsDisabled { get; set; }

  private Task AddTemplate() =>
    Instance.JustTemplates.Append(Template.initStandard).ToFList()
    .Apply(GromplateType.NewStandard)
    .Apply(UpdateGromplateType.InvokeAsync);

  private Task DeleteTemplate(Template template) =>
    Instance.JustTemplates.Where(x => x != template).ToFList()
    .Apply(GromplateType.NewStandard)
    .Apply(UpdateGromplateType.InvokeAsync);

}
