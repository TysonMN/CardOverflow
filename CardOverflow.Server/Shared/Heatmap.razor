@using Microsoft.FSharp.Core
@using CardOverflow.Entity
@using CardOverflow.Debug
@using CardOverflow.Pure
@using CardOverflow.Api
@using Microsoft.AspNetCore.Components
@using Microsoft.AspNetCore.Identity
@using CardOverflow.Sanitation
@inject DbExecutor DbExecutor

@* https://bitsofco.de/github-contribution-graph-css-grid/ *@
<div class="graph">
  <ul class="months">
    <li>Jan</li>
    <li>Feb</li>
    <li>Mar</li>
    <li>Apr</li>
    <li>May</li>
    <li>Jun</li>
    <li>Jul</li>
    <li>Aug</li>
    <li>Sep</li>
    <li>Oct</li>
    <li>Nov</li>
    <li>Dec</li>
  </ul>
  <ul class="days">
    <li>Sun</li>
    <li>Mon</li>
    <li>Tue</li>
    <li>Wed</li>
    <li>Thu</li>
    <li>Fri</li>
    <li>Sat</li>
  </ul>
  <ul class="squares">
    @foreach (var dateCount in _dateCounts) {
      <li data-level="@dateCount.Count"></li>
    }
  </ul>
</div>

@code {
  [CascadingParameter]
  UserEntity User { get; set; }

  private List<DateCount> _dateCounts = new List<DateCount>();

  protected override async Task OnInitializedAsync() {
    if (User != null) {
      _dateCounts = await DbExecutor.QueryAsync(x => HistoryRepository.getHeatmap(x, User.Id));
    }
  }

}
